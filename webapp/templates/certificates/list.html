{% extends "base.html" %}

{% block title %}Certificates{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Certificates{% if show_expired %} (Expired Only){% endif %}</h1>
    <div class="header-actions">
        {% if show_expired %}
        <a href="{{ url_for('web.list_certificates') }}" class="btn btn-secondary">Show All</a>
        {% else %}
        <a href="{{ url_for('web.list_certificates', expired='true') }}" class="btn btn-warning">Show Expired</a>
        {% endif %}
        <a href="{{ url_for('web.create_certificate') }}" class="btn btn-primary">Create Certificate</a>
    </div>
</div>

{% if certificates %}
<table class="table">
    <thead>
        <tr>
            <th>Common Name</th>
            <th>Domain / CA</th>
            <th>Organization</th>
            <th>Expires</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for cert in certificates %}
        <tr>
            <td>{{ cert.subject_cn or cert.cn or 'Unknown' }}</td>
            <td>
                <small>{{ cert.domain or '' }}</small><br>
                <strong>{{ cert.ca_name or '' }}</strong>
            </td>
            <td>{{ cert.subject_o or 'Unknown' }}</td>
            <td>{{ cert.not_after or 'Unknown' }}</td>
            <td>
                {% if cert.is_expired %}
                    <span class="badge badge-danger">Expired</span>
                {% elif cert.error %}
                    <span class="badge badge-warning">Error</span>
                {% else %}
                    <span class="badge badge-success">Valid</span>
                {% endif %}
            </td>
            <td class="action-cell">
                <a href="{{ url_for('web.certificate_detail', cn=cert.subject_cn or cert.cn or 'unknown') }}" class="btn btn-small">View</a>
                <form method="POST" action="{{ url_for('web.delete_certificate', cn=cert.subject_cn or cert.cn or 'unknown') }}" class="inline-form"
                      onsubmit="return confirm('Are you sure you want to delete this certificate?');">
                    <button type="submit" class="btn btn-small btn-danger">Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="empty-state">
    <p>{% if show_expired %}No expired certificates found.{% else %}No certificates found.{% endif %}</p>
    {% if not show_expired %}
    <a href="{{ url_for('web.create_certificate') }}" class="btn btn-primary">Create your first certificate</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}
